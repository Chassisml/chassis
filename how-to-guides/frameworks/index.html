<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../tutorials/ds-deploy/ rel=prev><link href=../common-data-types/ rel=next><link rel=icon href=../../images/chassis-symbol.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Model Containers by Framework - Chassis</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-4NVL0DTGZ4"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-4NVL0DTGZ4",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-4NVL0DTGZ4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../assets/stylesheets/custom.9097afc2.min.css><!-- <link rel="stylesheet" href="../../assets/stylesheets/code-snippet.css"> --></head> <body dir=ltr data-md-color-scheme=chassis data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#building-containers-for-common-machine-learning-and-deep-learning-frameworks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <a href=https://discord.gg/anSeEj8ARg> For updates join the <span style="color: #7289da">#chassisml</span> channel on <span class="twemoji discord"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </span> <strong>Discord</strong> </a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Chassis class="md-header__button md-logo" aria-label=Chassis data-md-component=logo> <img src=../../images/chassis-symbol-negative.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Chassis </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Model Containers by Framework </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/modzy/chassis title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> modzy/chassis </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../tutorials/deploy-manual/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> How-to Guides </a> </li> <li class=md-tabs__item> <a href=../../service-reference/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../conceptual-guides/overview/ class=md-tabs__link> Conceptual Guides </a> </li> <li class=md-tabs__item> <a href=../../common-errors/ class=md-tabs__link> Community </a> </li> <li class=md-tabs__item> <a href=../../release-notes/ class=md-tabs__link> Release Notes </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Chassis class="md-nav__button md-logo" aria-label=Chassis data-md-component=logo> <img src=../../images/chassis-symbol-negative.png alt=logo> </a> Chassis </label> <div class=md-nav__source> <a href=https://github.com/modzy/chassis title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> modzy/chassis </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/getting-started/ class=md-nav__link> Getting Started </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/deploy-manual/ class=md-nav__link> Install Service Manually </a> </li> <li class=md-nav__item> <a href=../../tutorials/ds-connect/ class=md-nav__link> Build a Model </a> </li> <li class=md-nav__item> <a href=../../tutorials/ds-postman/ class=md-nav__link> Run Model in Postman </a> </li> <li class=md-nav__item> <a href=../../tutorials/ds-deploy/ class=md-nav__link> Deploy Model to KServe </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=true> How-to Guides <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="How-to Guides" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> How-to Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Model Containers by Framework <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Model Containers by Framework </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#pytorch class=md-nav__link> PyTorch </a> </li> <li class=md-nav__item> <a href=#scikit-learn class=md-nav__link> Scikit-learn </a> </li> <li class=md-nav__item> <a href=#xgboost class=md-nav__link> XGBoost </a> </li> <li class=md-nav__item> <a href=#lightgbm class=md-nav__link> LightGBM </a> </li> <li class=md-nav__item> <a href=#fastai class=md-nav__link> Fastai </a> </li> <li class=md-nav__item> <a href=#mxnet class=md-nav__link> MXNet </a> </li> <li class=md-nav__item> <a href=#onnx class=md-nav__link> ONNX </a> </li> <li class=md-nav__item> <a href=#pmml class=md-nav__link> PMML </a> </li> <li class=md-nav__item> <a href=#tensorflow-keras class=md-nav__link> Tensorflow &amp; Keras </a> </li> <li class=md-nav__item> <a href=#spacy class=md-nav__link> Spacy </a> </li> <li class=md-nav__item> <a href=#spark-mllib class=md-nav__link> Spark MLlib </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../common-data-types/ class=md-nav__link> Common Data Types Support </a> </li> <li class=md-nav__item> <a href=../arm-support/ class=md-nav__link> Arm Support </a> </li> <li class=md-nav__item> <a href=../gpu-support/ class=md-nav__link> GPU Support </a> </li> <li class=md-nav__item> <a href=../private-registry/ class=md-nav__link> Private Docker Registry Support </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 tabindex=0 aria-expanded=false> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reference data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../service-reference/ class=md-nav__link> Chassisml Service </a> </li> <li class=md-nav__item> <a href=../../chassisml_sdk-reference/ class=md-nav__link> Python SDK </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 tabindex=0 aria-expanded=false> Conceptual Guides <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Conceptual Guides" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Conceptual Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../conceptual-guides/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../conceptual-guides/design/ class=md-nav__link> Design & Architecture </a> </li> <li class=md-nav__item> <a href=../../conceptual-guides/grpc/ class=md-nav__link> gRPC </a> </li> <li class=md-nav__item> <a href=../../conceptual-guides/containers/ class=md-nav__link> Containers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 tabindex=0 aria-expanded=false> Community <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Community data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../common-errors/ class=md-nav__link> FAQs </a> </li> <li class=md-nav__item> <a href=../../get-involved/ class=md-nav__link> Get Involved </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../release-notes/ class=md-nav__link> Release Notes </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=building-containers-for-common-machine-learning-and-deep-learning-frameworks>Building Containers for Common Machine Learning and Deep Learning Frameworks</h1> <p>If you build models using a common machine learning framework and you want a way to containerize them automatically, you have come to the right place! This page provides guides for leveraging Chassis to create containers out of your models built from the most popular ML frameworks available.</p> <p><strong>NOTE</strong>: This list of frameworks is <em>not</em> all-inclusive; instead, it is just a collection of examples from commonly-used frameworks we have seen data scientists gravitate towards. </p> <p>Can't find the framework you are looking for? Feel free to fork this repository, add an example or two from your framework of choice, and open a PR. Or come chat with us directly on <a href=https://discord.gg/tdfXFY2y>Discord</a>!</p> <div class="admonition warning"> <p class=admonition-title>Requirements</p> <p><em>To follow these how-to guides, you must first install the <code>chassisml</code> Python SDK and connect to the Chassis service either on your <a href=../../tutorials/deploy-manual/ >local machine</a> or to our <a href=../../getting-started/getting-started/ >publicly-hosted</a> instance within your Python IDE. You also will need an account with <a href=https://hub.docker.com/signup>Dockerhub</a>.</em> </p> <p>For help getting started, visit our <a href=https://chassis.ml/tutorials/devops-deploy/ >Tutorials</a> page.</p> </div> <h2 id=pytorch>PyTorch</h2> <p>This guide builds a simple Image Classification model with a ResNet50 architecture, avaialable directly in PyTorch's <a href=https://pytorch.org/vision/stable/models.html>Torvision model library</a>.</p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/pytorch/pytorch_resnet50_image_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>import</span> <span class=nn>pickle</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kn>import</span> <span class=nn>torch</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=kn>import</span> <span class=nn>torchvision.models</span> <span class=k>as</span> <span class=nn>models</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=kn>from</span> <span class=nn>torchvision</span> <span class=kn>import</span> <span class=n>transforms</span>
</code></pre></div> <p>Load model, labels, and any other dependencies required for inference.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>model</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>resnet50</span><span class=p>(</span><span class=n>pretrained</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>model</span><span class=o>.</span><span class=n>eval</span><span class=p>()</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>labels</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./data/imagenet_labels.pkl&#39;</span><span class=p>,</span><span class=s1>&#39;rb&#39;</span><span class=p>))</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>transform</span> <span class=o>=</span> <span class=n>transforms</span><span class=o>.</span><span class=n>Compose</span><span class=p>([</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>            <span class=n>transforms</span><span class=o>.</span><span class=n>ToPILImage</span><span class=p>(),</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>            <span class=n>transforms</span><span class=o>.</span><span class=n>Resize</span><span class=p>(</span><span class=mi>224</span><span class=p>),</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>            <span class=n>transforms</span><span class=o>.</span><span class=n>ToTensor</span><span class=p>(),</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>            <span class=n>transforms</span><span class=o>.</span><span class=n>Normalize</span><span class=p>(</span><span class=n>mean</span><span class=o>=</span><span class=p>[</span><span class=mf>0.485</span><span class=p>,</span> <span class=mf>0.456</span><span class=p>,</span> <span class=mf>0.406</span><span class=p>],</span> <span class=n>std</span><span class=o>=</span><span class=p>[</span><span class=mf>0.229</span><span class=p>,</span> <span class=mf>0.224</span><span class=p>,</span> <span class=mf>0.225</span><span class=p>])</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>        <span class=p>])</span>        
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=n>device</span> <span class=o>=</span> <span class=s1>&#39;cpu&#39;</span>
</code></pre></div> <p>Next, define <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=c1># preprocess</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=n>decoded</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>imdecode</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>frombuffer</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>),</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=n>img_t</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>decoded</span><span class=p>)</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=n>batch_t</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>unsqueeze</span><span class=p>(</span><span class=n>img_t</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=c1># run inference</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=n>predictions</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>batch_t</span><span class=p>)</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>    <span class=c1># postprocess</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=n>percentage</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>nn</span><span class=o>.</span><span class=n>functional</span><span class=o>.</span><span class=n>softmax</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>    <span class=n>_</span><span class=p>,</span> <span class=n>indices</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>predictions</span><span class=p>,</span> <span class=n>descending</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>        <span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>            <span class=p>{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>[</span><span class=n>idx</span><span class=o>.</span><span class=n>item</span><span class=p>()],</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=n>percentage</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=o>.</span><span class=n>item</span><span class=p>()}</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>        <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>indices</span><span class=p>[</span><span class=mi>0</span><span class=p>][:</span><span class=mi>5</span><span class=p>]</span> <span class=p>]</span>
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>    <span class=p>}</span>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>,</span>
<a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>        <span class=p>}</span>
<a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>    <span class=p>}</span>
<a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>
<a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/airplane.jpg&#39;</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;PyTorch ResNet50 Image Classification&quot;</span><span class=p>,</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=p>)</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=scikit-learn>Scikit-learn</h2> <p>This guide trains a Logistic Regression classifier on the <a href=https://scikit-learn.org/stable/auto_examples/datasets/plot_digits_last_image.html>Digits Dataset</a> and auto-containerizes via the <code>chassisml</code> Python SDK. Visit the original classification exercise <a href=https://scikit-learn.org/stable/auto_examples/exercises/plot_digits_classification_exercise.html#sphx-glr-auto-examples-exercises-plot-digits-classification-exercise-py>here</a>.</p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/sklearn/sklearn_logreg_image_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=kn>from</span> <span class=nn>sklearn.linear_model</span> <span class=kn>import</span> <span class=n>LogisticRegression</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=kn>from</span> <span class=nn>sklearn</span> <span class=kn>import</span> <span class=n>datasets</span>
</code></pre></div> <p>Load dataset, perform data preprocessing, and train the model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Import and normalize data</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>X_digits</span><span class=p>,</span> <span class=n>y_digits</span> <span class=o>=</span> <span class=n>datasets</span><span class=o>.</span><span class=n>load_digits</span><span class=p>(</span><span class=n>return_X_y</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>X_digits</span> <span class=o>=</span> <span class=n>X_digits</span> <span class=o>/</span> <span class=n>X_digits</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=n>n_samples</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>X_digits</span><span class=p>)</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1># Split data into training and test sets</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=n>X_train</span> <span class=o>=</span> <span class=n>X_digits</span><span class=p>[:</span> <span class=nb>int</span><span class=p>(</span><span class=mf>0.9</span> <span class=o>*</span> <span class=n>n_samples</span><span class=p>)]</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=n>y_train</span> <span class=o>=</span> <span class=n>y_digits</span><span class=p>[:</span> <span class=nb>int</span><span class=p>(</span><span class=mf>0.9</span> <span class=o>*</span> <span class=n>n_samples</span><span class=p>)]</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=n>X_test</span> <span class=o>=</span> <span class=n>X_digits</span><span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=mf>0.9</span> <span class=o>*</span> <span class=n>n_samples</span><span class=p>)</span> <span class=p>:]</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=n>y_test</span> <span class=o>=</span> <span class=n>y_digits</span><span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=mf>0.9</span> <span class=o>*</span> <span class=n>n_samples</span><span class=p>)</span> <span class=p>:]</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=c1># Train Model</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=n>logistic</span> <span class=o>=</span> <span class=n>LogisticRegression</span><span class=p>(</span><span class=n>max_iter</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=nb>print</span><span class=p>(</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>    <span class=s2>&quot;LogisticRegression mean accuracy score: </span><span class=si>%f</span><span class=s2>&quot;</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>    <span class=o>%</span> <span class=n>logistic</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>X_test</span><span class=p>,</span> <span class=n>y_test</span><span class=p>)</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=p>)</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=c1># Save small sample input to use for testing later</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=n>sample</span> <span class=o>=</span> <span class=n>X_test</span><span class=p>[:</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;data/digits_sample.json&quot;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>out</span><span class=p>:</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>    <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>sample</span><span class=p>,</span> <span class=n>out</span><span class=p>)</span>
</code></pre></div> <p>Next, prepare a <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>))</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>inference_results</span> <span class=o>=</span> <span class=n>logistic</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>structured_results</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=k>for</span> <span class=n>inference_result</span> <span class=ow>in</span> <span class=n>inference_results</span><span class=p>:</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>        <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>            <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>                <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>inference_result</span><span class=p>),</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=mi>1</span><span class=p>)}]}</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>            <span class=p>}</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>        <span class=p>}</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>        <span class=n>structured_results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>structured_output</span><span class=p>)</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>    <span class=k>return</span> <span class=n>structured_results</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/digits_sample.json&#39;</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Manually construct a conda environment to pass through as parameter to Chassis job. <strong>NOTE:</strong> By default, Chassis will infer all required dependencies, objects, and functions based on what is referenced within the <code>process</code> method. However, if you prefer to manually define your environment, you can do so as well.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>env</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;sklearn-chassis&quot;</span><span class=p>,</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=s2>&quot;channels&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;conda-forge&#39;</span><span class=p>],</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=s2>&quot;dependencies&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        <span class=s2>&quot;python=3.8.5&quot;</span><span class=p>,</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>        <span class=p>{</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>            <span class=s2>&quot;pip&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>                <span class=s2>&quot;scikit-learn&quot;</span><span class=p>,</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>                <span class=s2>&quot;numpy&quot;</span><span class=p>,</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>                <span class=s2>&quot;chassisml&quot;</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>            <span class=p>]</span> 
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>        <span class=p>}</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=p>]</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=p>}</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;Sklearn Logistic Regression Digits Image Classification&quot;</span><span class=p>,</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=n>conda_env</span><span class=o>=</span><span class=n>env</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=p>)</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=xgboost>XGBoost</h2> <p>This guide trains an XGBoost regression model that predicts housing prices based on a series of features in the <a href=https://www.kaggle.com/prasadperera/the-boston-housing-dataset>Boston Housing tabular dataset</a>. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/xgboost/xgboost_house_price_predictions.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>StringIO</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=kn>import</span> <span class=nn>xgboost</span> <span class=k>as</span> <span class=nn>xgb</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=kn>from</span> <span class=nn>sklearn.datasets</span> <span class=kn>import</span> <span class=n>load_boston</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>mean_squared_error</span>
</code></pre></div> <p>Load dataset, build XGBoost regressor model, and train the model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># load data</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=n>boston</span> <span class=o>=</span> <span class=n>load_boston</span><span class=p>()</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=n>X</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>boston</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>boston</span><span class=o>.</span><span class=n>feature_names</span><span class=p>)</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=n>y</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>boston</span><span class=o>.</span><span class=n>target</span><span class=p>)</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=c1># save sample data for testing later</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;data/sample_house_data.csv&quot;</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>    <span class=n>X_test</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=c1># build XGBoost regressor</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=n>regressor</span> <span class=o>=</span> <span class=n>xgb</span><span class=o>.</span><span class=n>XGBRegressor</span><span class=p>(</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>    <span class=n>n_estimators</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>    <span class=n>reg_lambda</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>    <span class=n>gamma</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>    <span class=n>max_depth</span><span class=o>=</span><span class=mi>3</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=p>)</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=c1># train model</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=n>regressor</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</code></pre></div> <p>The <code>fit()</code> execution will print the following in your notebook: <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>             colsample_bynode=1, colsample_bytree=1, enable_categorical=False,
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>             gamma=0, gpu_id=-1, importance_type=None,
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>             interaction_constraints=&#39;&#39;, learning_rate=0.300000012,
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>             max_delta_step=0, max_depth=3, min_child_weight=1, missing=nan,
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>             monotone_constraints=&#39;()&#39;, n_estimators=100, n_jobs=12,
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>             num_parallel_tree=1, predictor=&#39;auto&#39;, random_state=0, reg_alpha=0,
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>             reg_lambda=1, scale_pos_weight=1, subsample=1, tree_method=&#39;exact&#39;,
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>             validate_parameters=1, verbosity=None)
</code></pre></div></p> <p>Run inference on your <code>X_test</code> subset and evaluate model performance.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># run inference</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>y_pred</span> <span class=o>=</span> <span class=n>regressor</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>X_test</span><span class=p>)</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1># evaluate model</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=n>mean_squared_error</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=o>&gt;&gt;&gt;&gt;</span> <span class=mf>7.658965947061991</span>
</code></pre></div> <p>Next, prepare a <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    <span class=c1># load data</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>StringIO</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>,</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>)))</span>    
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=c1># run inference</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=n>preds</span> <span class=o>=</span> <span class=n>regressor</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>    <span class=c1># structure results</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>        <span class=s2>&quot;housePricePredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>            <span class=p>{</span><span class=s2>&quot;row&quot;</span><span class=p>:</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;price&quot;</span><span class=p>:</span> <span class=n>preds</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>1000</span><span class=p>}</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>preds</span><span class=p>))</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>        <span class=p>]</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>    <span class=p>}</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>,</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>        <span class=p>}</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>    <span class=p>}</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/sample_house_data.csv&#39;</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will successfully run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;XGBoost Boston Housing Price Predictions&quot;</span><span class=p>,</span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=p>)</span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=lightgbm>LightGBM</h2> <p>This guide builds a LightGBM classifier model to predict the likelihood of women being diagnosed with Breast Cancer. This guide was adapted from this <a href=https://www.kaggle.com/prashant111/lightgbm-classifier-in-python>Kaggle notebook</a>. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/lightgbm/lightgbm_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>StringIO</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=kn>import</span> <span class=nn>lightgbm</span> <span class=k>as</span> <span class=nn>lgb</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>accuracy_score</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</code></pre></div> <p>Load dataset, perform data preprocessing, build and then train LightGBM classifier model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># load breast cancer dataset</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;./data/Breast_cancer_data.csv&#39;</span><span class=p>)</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=c1># preprocess data</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=n>X</span> <span class=o>=</span> <span class=n>df</span><span class=p>[[</span><span class=s1>&#39;mean_radius&#39;</span><span class=p>,</span><span class=s1>&#39;mean_texture&#39;</span><span class=p>,</span><span class=s1>&#39;mean_perimeter&#39;</span><span class=p>,</span><span class=s1>&#39;mean_area&#39;</span><span class=p>,</span><span class=s1>&#39;mean_smoothness&#39;</span><span class=p>]]</span>
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=n>y</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;diagnosis&#39;</span><span class=p>]</span>
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span> <span class=o>=</span> <span class=mf>0.3</span><span class=p>,</span> <span class=n>random_state</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=c1># build and train model</span>
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=n>clf</span> <span class=o>=</span> <span class=n>lgb</span><span class=o>.</span><span class=n>LGBMClassifier</span><span class=p>()</span>
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=n>clf</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</code></pre></div> <p>Run inference on your test subset and evaluate model accuracy <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=n>y_pred</span><span class=o>=</span><span class=n>clf</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>X_test</span><span class=p>)</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>accuracy</span><span class=o>=</span><span class=n>accuracy_score</span><span class=p>(</span><span class=n>y_pred</span><span class=p>,</span> <span class=n>y_test</span><span class=p>)</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;LightGBM Model accuracy score: </span><span class=si>{0:0.4f}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>accuracy_score</span><span class=p>(</span><span class=n>y_test</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)))</span>
</code></pre></div></p> <p>You should see this in your console: <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>LightGBM Model accuracy score: 0.9298
</code></pre></div></p> <p>Next, prepare a <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=n>labels</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;No Cancer&quot;</span><span class=p>,</span> <span class=s2>&quot;Cancer&quot;</span><span class=p>]</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>StringIO</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>,</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>)))</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=n>preds</span> <span class=o>=</span> <span class=n>clf</span><span class=o>.</span><span class=n>predict_proba</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>        <span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>            <span class=p>{</span><span class=s2>&quot;row&quot;</span><span class=p>:</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>pred</span><span class=p>)],</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>pred</span><span class=p>)}</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>pred</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>preds</span><span class=p>)</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>        <span class=p>]</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>    <span class=p>}</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>,</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>        <span class=p>}</span>
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a>    <span class=p>}</span>
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a>
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;data/sample_cancer_data.csv&#39;</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will successfully run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;Chassis LightGBM Breast Cancer Classification&quot;</span><span class=p>,</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=p>)</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=fastai>Fastai</h2> <p>This builds off Fastai's <a href=https://docs.fast.ai/tutorial.tabular.html>Tabular training tutorial</a>, which predicts the income of adults based on various education and socioeconomic factors. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/fastai/fastai_tabular_training.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=kn>import</span> <span class=nn>os</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>StringIO</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=kn>from</span> <span class=nn>fastai.tabular.all</span> <span class=kn>import</span> <span class=n>TabularDataLoaders</span><span class=p>,</span> <span class=n>RandomSplitter</span><span class=p>,</span> <span class=n>TabularPandas</span><span class=p>,</span> <span class=n>tabular_learner</span><span class=p>,</span> <span class=n>Categorify</span><span class=p>,</span> <span class=n>FillMissing</span><span class=p>,</span> <span class=n>Normalize</span><span class=p>,</span> <span class=n>range_of</span><span class=p>,</span> <span class=n>accuracy</span>
</code></pre></div> <p>Begin by loading and preprocessing dataset. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&quot;./data/adult_sample/adult.csv&quot;</span><span class=p>)</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=n>df</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=n>dls</span> <span class=o>=</span> <span class=n>TabularDataLoaders</span><span class=o>.</span><span class=n>from_csv</span><span class=p>(</span><span class=s2>&quot;./data/adult_sample/adult.csv&quot;</span><span class=p>,</span> <span class=n>path</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>(),</span> <span class=s2>&quot;data/adult_sample&quot;</span><span class=p>),</span> <span class=n>y_names</span><span class=o>=</span><span class=s2>&quot;salary&quot;</span><span class=p>,</span>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>    <span class=n>cat_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;workclass&#39;</span><span class=p>,</span> <span class=s1>&#39;education&#39;</span><span class=p>,</span> <span class=s1>&#39;marital-status&#39;</span><span class=p>,</span> <span class=s1>&#39;occupation&#39;</span><span class=p>,</span> <span class=s1>&#39;relationship&#39;</span><span class=p>,</span> <span class=s1>&#39;race&#39;</span><span class=p>],</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>    <span class=n>cont_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;age&#39;</span><span class=p>,</span> <span class=s1>&#39;fnlwgt&#39;</span><span class=p>,</span> <span class=s1>&#39;education-num&#39;</span><span class=p>],</span>
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>    <span class=n>procs</span> <span class=o>=</span> <span class=p>[</span><span class=n>Categorify</span><span class=p>,</span> <span class=n>FillMissing</span><span class=p>,</span> <span class=n>Normalize</span><span class=p>])</span>
<a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>
<a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a><span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span> <span class=o>=</span> <span class=mf>0.3</span><span class=p>,</span> <span class=n>random_state</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
<a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a>
<a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=n>splits</span> <span class=o>=</span> <span class=n>RandomSplitter</span><span class=p>(</span><span class=n>valid_pct</span><span class=o>=</span><span class=mf>0.2</span><span class=p>)(</span><span class=n>range_of</span><span class=p>(</span><span class=n>df</span><span class=p>))</span>
<a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=n>to</span> <span class=o>=</span> <span class=n>TabularPandas</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>procs</span><span class=o>=</span><span class=p>[</span><span class=n>Categorify</span><span class=p>,</span> <span class=n>FillMissing</span><span class=p>,</span><span class=n>Normalize</span><span class=p>],</span>
<a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a>                   <span class=n>cat_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;workclass&#39;</span><span class=p>,</span> <span class=s1>&#39;education&#39;</span><span class=p>,</span> <span class=s1>&#39;marital-status&#39;</span><span class=p>,</span> <span class=s1>&#39;occupation&#39;</span><span class=p>,</span> <span class=s1>&#39;relationship&#39;</span><span class=p>,</span> <span class=s1>&#39;race&#39;</span><span class=p>],</span>
<a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a>                   <span class=n>cont_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;age&#39;</span><span class=p>,</span> <span class=s1>&#39;fnlwgt&#39;</span><span class=p>,</span> <span class=s1>&#39;education-num&#39;</span><span class=p>],</span>
<a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a>                   <span class=n>y_names</span><span class=o>=</span><span class=s1>&#39;salary&#39;</span><span class=p>,</span>
<a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a>                   <span class=n>splits</span><span class=o>=</span><span class=n>splits</span><span class=p>)</span>
<a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a>
<a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=c1># save test subset</span>
<a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=n>test_df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a><span class=n>test_df</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;salary&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=n>test_df</span><span class=p>[:</span><span class=mi>20</span><span class=p>]</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=s2>&quot;./data/sample_adult_data.csv&quot;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a>
<a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a><span class=c1># rebuild dataloaders with preprocessed data</span>
<a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=n>dls</span> <span class=o>=</span> <span class=n>to</span><span class=o>.</span><span class=n>dataloaders</span><span class=p>(</span><span class=n>bs</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
</code></pre></div> <p>Now, we will build and train our model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=n>learn</span> <span class=o>=</span> <span class=n>tabular_learner</span><span class=p>(</span><span class=n>dls</span><span class=p>,</span> <span class=n>metrics</span><span class=o>=</span><span class=n>accuracy</span><span class=p>)</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=n>learn</span><span class=o>.</span><span class=n>fit_one_cycle</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> <p>The output of this training experiment should look similar to the following table:</p> <table> <thead> <tr> <th>epoch</th> <th>train_loss</th> <th>valid_loss</th> <th>accuracy</th> <th>time</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0.370123</td> <td>0.364591</td> <td>0.832002</td> <td>00:03</td> </tr> </tbody> </table> <p>View the full results of the training experiment.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=n>learn</span><span class=o>.</span><span class=n>show_results</span><span class=p>()</span>
</code></pre></div> <p>Now, we will test the inference flow that works with the Fastai framework.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=n>test_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&quot;./data/sample_adult_data.csv&quot;</span><span class=p>)</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=n>dl</span> <span class=o>=</span> <span class=n>learn</span><span class=o>.</span><span class=n>dls</span><span class=o>.</span><span class=n>test_dl</span><span class=p>(</span><span class=n>test_df</span><span class=p>)</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=n>preds</span> <span class=o>=</span> <span class=n>learn</span><span class=o>.</span><span class=n>get_preds</span><span class=p>(</span><span class=n>dl</span><span class=o>=</span><span class=n>dl</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
</code></pre></div> <p>Next, prepare a <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=n>labels</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&lt;50k&#39;</span><span class=p>,</span> <span class=s1>&#39;&gt;50k&#39;</span><span class=p>]</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>StringIO</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>,</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>)))</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>    <span class=n>dl</span> <span class=o>=</span> <span class=n>learn</span><span class=o>.</span><span class=n>dls</span><span class=o>.</span><span class=n>test_dl</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>    <span class=n>preds</span> <span class=o>=</span> <span class=n>learn</span><span class=o>.</span><span class=n>get_preds</span><span class=p>(</span><span class=n>dl</span><span class=o>=</span><span class=n>dl</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>numpy</span><span class=p>()</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>        <span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>            <span class=p>{</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>                <span class=s2>&quot;row&quot;</span><span class=p>:</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>                <span class=s2>&quot;predictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>                    <span class=p>{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=nb>round</span><span class=p>(</span><span class=n>pred</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=mi>4</span><span class=p>)}</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a>                <span class=p>]</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>            <span class=p>}</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>pred</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>preds</span><span class=p>)</span>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a>        <span class=p>]</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>    <span class=p>}</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>,</span>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a>        <span class=p>}</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a>    <span class=p>}</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/sample_adult_data.csv&#39;</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will successfully run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;Fast AI Salary Prediction&quot;</span><span class=p>,</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=p>)</span>
<a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a>
<a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=mxnet>MXNet</h2> <p>This guide leverages the <a href=https://mxnet.apache.org/versions/1.9.0/ >MXNet framework</a> to build a simple Image Classification model with a MobileNet architecture, avaialable directly in MXNet's <a href=https://mxnet.apache.org/api/python/docs/api/gluon/model_zoo/index.html>Gluon Model Zoo</a>. This guide is an adaptation of MXNet's <a href=https://mxnet.apache.org/versions/1.6/api/python/docs/tutorials/packages/gluon/image/pretrained_models.html#Loading-the-model>tutorial</a> for using pretrained models. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/mxnet/mxnet_mobilenet_image_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=kn>import</span> <span class=nn>mxnet</span> <span class=k>as</span> <span class=nn>mx</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=kn>import</span> <span class=nn>mxnet.image</span> <span class=k>as</span> <span class=nn>mxnet_img</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=kn>from</span> <span class=nn>mxnet</span> <span class=kn>import</span> <span class=n>gluon</span><span class=p>,</span> <span class=n>nd</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=kn>from</span> <span class=nn>mxnet.gluon.model_zoo</span> <span class=kn>import</span> <span class=n>vision</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</code></pre></div> <p>Load pretrained <code>MobileNet</code> model from <a href=https://mxnet.apache.org/api/python/docs/api/gluon/model_zoo/index.html>Gluon Model Zoo</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=n>ctx</span> <span class=o>=</span> <span class=n>mx</span><span class=o>.</span><span class=n>cpu</span><span class=p>()</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=n>mobileNet</span> <span class=o>=</span> <span class=n>vision</span><span class=o>.</span><span class=n>mobilenet0_5</span><span class=p>(</span><span class=n>pretrained</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ctx</span><span class=o>=</span><span class=n>ctx</span><span class=p>)</span>
</code></pre></div> <p>Next, load ImageNet labels file and sample dog image for testing. We will visualize this image in our notebook for reference.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1># load imagenet labels for postprocessing</span>
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=n>imagenet_labels</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;data/image_net_labels.json&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)))</span>
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=nb>print</span><span class=p>(</span><span class=n>imagenet_labels</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=c1># load sample image</span>
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=n>filename</span> <span class=o>=</span> <span class=s2>&quot;data/dog.jpg&quot;</span>
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=c1># visualize image to test</span>
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=n>image</span> <span class=o>=</span> <span class=n>mx</span><span class=o>.</span><span class=n>image</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>image</span><span class=o>.</span><span class=n>asnumpy</span><span class=p>())</span>
</code></pre></div> <p>An image of a boxer dog should appear under this cell.</p> <p>Now, we will define an inference method specific to the MXNet framework.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=k>def</span> <span class=nf>predict</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>categories</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>    <span class=n>predictions</span> <span class=o>=</span> <span class=n>model</span><span class=p>(</span><span class=n>transform</span><span class=p>(</span><span class=n>image</span><span class=p>))</span><span class=o>.</span><span class=n>softmax</span><span class=p>()</span>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>    <span class=n>top_pred</span> <span class=o>=</span> <span class=n>predictions</span><span class=o>.</span><span class=n>topk</span><span class=p>(</span><span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>asnumpy</span><span class=p>()</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>    <span class=n>probs</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>    <span class=n>labels</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>    <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=n>top_pred</span><span class=p>:</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>        <span class=n>probability</span> <span class=o>=</span> <span class=n>predictions</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=nb>int</span><span class=p>(</span><span class=n>index</span><span class=p>)]</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a>        <span class=n>probs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>probability</span><span class=o>.</span><span class=n>asscalar</span><span class=p>())</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>        <span class=n>category</span> <span class=o>=</span> <span class=n>categories</span><span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>index</span><span class=p>)]</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>        <span class=n>labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>category</span><span class=p>)</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>    <span class=k>return</span> <span class=n>probs</span><span class=p>,</span> <span class=n>labels</span>
</code></pre></div> <p>Test this function locally to ensure your model is behaving how you intend it to.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># test model</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=n>probs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>predict</span><span class=p>(</span><span class=n>mobileNet</span><span class=p>,</span> <span class=n>image</span><span class=p>,</span> <span class=n>imagenet_labels</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=nb>print</span><span class=p>(</span><span class=n>probs</span><span class=p>)</span>
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=nb>print</span><span class=p>(</span><span class=n>labels</span><span class=p>)</span>
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=o>&gt;&gt;&gt;</span> <span class=p>[</span><span class=mf>0.84015656</span><span class=p>,</span> <span class=mf>0.13626784</span><span class=p>,</span> <span class=mf>0.006610237</span><span class=p>]</span>
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=o>&gt;&gt;&gt;</span> <span class=p>[</span><span class=s1>&#39;boxer&#39;</span><span class=p>,</span> <span class=s1>&#39;bull mastiff&#39;</span><span class=p>,</span> <span class=s1>&#39;Rhodesian ridgeback&#39;</span><span class=p>]</span>
</code></pre></div> <p>Next, define <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>    <span class=c1># read image bytes</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>    <span class=n>img</span> <span class=o>=</span> <span class=n>mxnet_img</span><span class=o>.</span><span class=n>imdecode</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>)</span>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a>    <span class=c1># run inference</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>    <span class=n>probs</span><span class=p>,</span> <span class=n>labels</span> <span class=o>=</span> <span class=n>predict</span><span class=p>(</span><span class=n>mobileNet</span><span class=p>,</span> <span class=n>img</span><span class=p>,</span> <span class=n>imagenet_labels</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a>    <span class=c1># structure results</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>        <span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>            <span class=p>{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=n>probs</span><span class=p>[</span><span class=n>i</span><span class=p>]}</span>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>probs</span><span class=p>))</span> <span class=p>]</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a>    <span class=p>}</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>,</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a>        <span class=p>}</span>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a>    <span class=p>}</span>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/dog.jpg&#39;</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;MXNET MobileNet Image Classifiction&quot;</span><span class=p>,</span>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=p>)</span>
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=onnx>ONNX</h2> <p>This guide leverages the <code>chassisml</code> SDK to auto-containerize a pretrained model from the <a href=https://github.com/onnx/models/tree/main/vision/classification/mobilenet>ONNX Model Zoo</a>. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/onnx/onnx_mobilenet_image_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=kn>import</span> <span class=nn>cv2</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=kn>import</span> <span class=nn>pickle</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=kn>import</span> <span class=nn>tempfile</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=kn>from</span> <span class=nn>shutil</span> <span class=kn>import</span> <span class=n>rmtree</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=kn>import</span> <span class=nn>onnx</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=kn>from</span> <span class=nn>onnx</span> <span class=kn>import</span> <span class=n>backend</span>
<a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=kn>from</span> <span class=nn>onnx</span> <span class=kn>import</span> <span class=n>numpy_helper</span>
<a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=kn>import</span> <span class=nn>onnxruntime</span> <span class=k>as</span> <span class=nn>ort</span>
<a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</code></pre></div> <p>Load pretrained <code>MobileNet</code> model from <a href=https://github.com/onnx/models/tree/main/vision/classification/mobilenet>ONNX Model Zoo</a> and confirm it is a valid ONNX model.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=n>model</span> <span class=o>=</span> <span class=n>onnx</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&quot;models/mobilenetv2-7.onnx&quot;</span><span class=p>)</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=n>onnx</span><span class=o>.</span><span class=n>checker</span><span class=o>.</span><span class=n>check_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</code></pre></div> <p>Next, load sample data and execute a few minor preprocessing steps.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=c1># format sample data and reshape</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=n>img</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>cv2</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=s1>&#39;data/dog.jpg&#39;</span><span class=p>),</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_BGR2RGB</span><span class=p>)</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=n>img_show</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>resize</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>(</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>))</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=n>sample_img</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img_show</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=c1># load imagenet labels</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=n>labels</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;./data/imagenet_labels.pkl&#39;</span><span class=p>,</span><span class=s1>&#39;rb&#39;</span><span class=p>))</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=c1># visualize image</span>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>()</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=n>plt</span><span class=o>.</span><span class=n>colorbar</span><span class=p>()</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <p>An image of a yellow lab dog should appear under this cell.</p> <p>Now, we will create an ONNX runtime inference session and test our model locally. <strong>NOTE:</strong> Some frameworks have their own ONNX runtime compatibility built in, but ONNX Runtime (ORT) can be used to run models built in many common frameworks - including PyTorch, Tensorflow, TFLite, Scikit-Learn, to name a few - but saved in the standardized ONNX format. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=c1># create onnx runtime inference session and print top prediction</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=n>session</span> <span class=o>=</span> <span class=n>ort</span><span class=o>.</span><span class=n>InferenceSession</span><span class=p>(</span><span class=s2>&quot;models/mobilenetv2-7.onnx&quot;</span><span class=p>)</span>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=n>results</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>sample_img</span><span class=p>})</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Top Prediction: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>labels</span><span class=p>[</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>argmax</span><span class=p>()]))</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=o>&gt;&gt;&gt;</span> <span class=s2>&quot;Top Prediction: sunglass&quot;</span>
</code></pre></div> <p>Next, define <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object. One strict requirement to use Chassis is that your model <em>must</em> be able to be loaded into memory and perform an inference call from it's loaded, pre-trained state. Due to the unique ORT syntax that requires a <em>model file</em> be passed through as a parameter when creating an ORT inference session (which means it must be loaded to memory as a part of the inference session instantiation, not loaded before), we will get a little creative and leverage Python's <a href=https://docs.python.org/3/library/tempfile.html>tempfile</a> library to take the loaded model, save it to a temporary directory as a <code>.onnx</code> file, and load it back in during inference. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>    <span class=c1># save model to filepath for inference</span>
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>    <span class=n>tmp_dir</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>mkdtemp</span><span class=p>()</span>
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a>    <span class=kn>import</span> <span class=nn>onnx</span>
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a>    <span class=n>onnx</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/model.onnx&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>))</span>
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>
<a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a>    <span class=c1># preprocess data</span>
<a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a>    <span class=n>decoded</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>cv2</span><span class=o>.</span><span class=n>imdecode</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>frombuffer</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>uint8</span><span class=p>),</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=n>cv2</span><span class=o>.</span><span class=n>COLOR_BGR2RGB</span><span class=p>)</span>
<a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a>    <span class=n>img</span> <span class=o>=</span> <span class=n>cv2</span><span class=o>.</span><span class=n>resize</span><span class=p>(</span><span class=n>decoded</span><span class=p>,</span> <span class=p>(</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>))</span>
<a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a>    <span class=n>img</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>224</span><span class=p>,</span><span class=mi>224</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
<a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a>
<a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a>    <span class=c1># run inference</span>
<a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a>    <span class=n>session</span> <span class=o>=</span> <span class=n>ort</span><span class=o>.</span><span class=n>InferenceSession</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2>/model.onnx&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>))</span>
<a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a>    <span class=n>results</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>img</span><span class=p>})</span>
<a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a>
<a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a>    <span class=c1># postprocess</span>
<a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=n>labels</span><span class=p>[</span><span class=n>results</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>argmax</span><span class=p>()]</span>
<a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a>
<a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a>    <span class=c1># format results</span>
<a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a>    <span class=n>structured_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>inference_result</span><span class=p>)}]}</span>
<a id=__codelineno-57-23 name=__codelineno-57-23 href=#__codelineno-57-23></a>        <span class=p>}</span>
<a id=__codelineno-57-24 name=__codelineno-57-24 href=#__codelineno-57-24></a>    <span class=p>}</span>
<a id=__codelineno-57-25 name=__codelineno-57-25 href=#__codelineno-57-25></a>
<a id=__codelineno-57-26 name=__codelineno-57-26 href=#__codelineno-57-26></a>    <span class=c1># remove temp directory</span>
<a id=__codelineno-57-27 name=__codelineno-57-27 href=#__codelineno-57-27></a>    <span class=n>rmtree</span><span class=p>(</span><span class=n>tmp_dir</span><span class=p>)</span>
<a id=__codelineno-57-28 name=__codelineno-57-28 href=#__codelineno-57-28></a>    <span class=k>return</span> <span class=n>structured_result</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/dog.jpg&#39;</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a>
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;ONNX MobileNet Image Classifiction&quot;</span><span class=p>,</span>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=p>)</span>
<a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a>
<a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=pmml>PMML</h2> <p>Predictive Model Markup Language (PMML) is an XML-based model format that is widely accepted and used to save machine learning models. This guide leverages the <code>chassisml</code> SDK to auto-containerize a pretrained model from this <a href=https://github.com/iamDecode/sklearn-pmml-model/tree/master/models>PMML Scikit-Learn package model library</a>. </p> <p>To follow along, you can reference the Jupyter notebook example and data files <a href=https://github.com/modzy/chassis/blob/main/chassisml_sdk/examples/pmml/pmml_iris_forest_classification.ipynb>here</a>.</p> <p>Import required dependencies.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=kn>import</span> <span class=nn>chassisml</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=kn>import</span> <span class=nn>getpass</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=kn>import</span> <span class=nn>json</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>StringIO</span>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=kn>from</span> <span class=nn>sklearn.datasets</span> <span class=kn>import</span> <span class=n>load_iris</span>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=kn>from</span> <span class=nn>sklearn_pmml_model.ensemble</span> <span class=kn>import</span> <span class=n>PMMLForestClassifier</span>
</code></pre></div> <p>First, load and preprocess training data. <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=c1># Prepare data</span>
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=n>iris</span> <span class=o>=</span> <span class=n>load_iris</span><span class=p>()</span>
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=n>X</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>iris</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=n>X</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>iris</span><span class=o>.</span><span class=n>feature_names</span><span class=p>)</span>
<a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=n>y</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>iris</span><span class=o>.</span><span class=n>target_names</span><span class=p>)[</span><span class=n>iris</span><span class=o>.</span><span class=n>target</span><span class=p>])</span>
<a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=n>y</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;Class&quot;</span>
<a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=n>Xtr</span><span class=p>,</span> <span class=n>Xte</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>yte</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.33</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>123</span><span class=p>)</span>
<a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a>
<a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=c1># Create sample data for testing later</span>
<a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;data/sample_iris.csv&quot;</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
<a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a>    <span class=n>Xte</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div></p> <p>Next, load the <code>.pmml</code> model file with the <code>sklearn_pmml</code> convenience package. We can then run a sample inference test with our test subset. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=c1># Load model</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=n>clf</span> <span class=o>=</span> <span class=n>PMMLForestClassifier</span><span class=p>(</span><span class=n>pmml</span><span class=o>=</span><span class=s2>&quot;models/randomForest.pmml&quot;</span><span class=p>)</span>
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=n>labels</span> <span class=o>=</span> <span class=n>clf</span><span class=o>.</span><span class=n>classes_</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
<a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a>
<a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=c1># Test model</span>
<a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=n>clf</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xte</span><span class=p>)</span>
<a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=n>clf</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>Xte</span><span class=p>,</span> <span class=n>yte</span><span class=p>)</span>
</code></pre></div> <p>Now, we will define some pre- and post-processing methods that our model can use during inference.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=k>def</span> <span class=nf>preprocess_inputs</span><span class=p>(</span><span class=n>raw_input_bytes</span><span class=p>):</span>
<a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a>    <span class=c1># load data</span>
<a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>StringIO</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>raw_input_bytes</span><span class=p>,</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>)))</span>
<a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a>    <span class=k>return</span> <span class=n>inputs</span>
<a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a>
<a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=k>def</span> <span class=nf>postprocess_outputs</span><span class=p>(</span><span class=n>raw_predictions</span><span class=p>):</span>
<a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a>    <span class=c1># process output</span>
<a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a>    <span class=n>inference_result</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a>        <span class=s2>&quot;result&quot;</span><span class=p>:[</span>
<a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a>            <span class=p>{</span>
<a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a>                <span class=s2>&quot;row&quot;</span><span class=p>:</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a>                <span class=s2>&quot;classPredictions&quot;</span><span class=p>:</span> <span class=p>[</span>
<a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a>                    <span class=p>{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=n>results</span><span class=p>[</span><span class=n>idx</span><span class=p>]}</span>
<a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a>                    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>results</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
<a id=__codelineno-65-15 name=__codelineno-65-15 href=#__codelineno-65-15></a>                <span class=p>]</span>  
<a id=__codelineno-65-16 name=__codelineno-65-16 href=#__codelineno-65-16></a>            <span class=p>}</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>results</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>raw_predictions</span><span class=p>)</span>
<a id=__codelineno-65-17 name=__codelineno-65-17 href=#__codelineno-65-17></a>        <span class=p>]</span> 
<a id=__codelineno-65-18 name=__codelineno-65-18 href=#__codelineno-65-18></a>
<a id=__codelineno-65-19 name=__codelineno-65-19 href=#__codelineno-65-19></a>    <span class=p>}</span>    
<a id=__codelineno-65-20 name=__codelineno-65-20 href=#__codelineno-65-20></a>
<a id=__codelineno-65-21 name=__codelineno-65-21 href=#__codelineno-65-21></a>
<a id=__codelineno-65-22 name=__codelineno-65-22 href=#__codelineno-65-22></a>    <span class=c1># format output</span>
<a id=__codelineno-65-23 name=__codelineno-65-23 href=#__codelineno-65-23></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-65-24 name=__codelineno-65-24 href=#__codelineno-65-24></a>        <span class=s2>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
<a id=__codelineno-65-25 name=__codelineno-65-25 href=#__codelineno-65-25></a>            <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>inference_result</span><span class=p>[</span><span class=s2>&quot;result&quot;</span><span class=p>],</span>
<a id=__codelineno-65-26 name=__codelineno-65-26 href=#__codelineno-65-26></a>            <span class=s2>&quot;explanation&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-65-27 name=__codelineno-65-27 href=#__codelineno-65-27></a>            <span class=s2>&quot;drift&quot;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-65-28 name=__codelineno-65-28 href=#__codelineno-65-28></a>        <span class=p>}</span>
<a id=__codelineno-65-29 name=__codelineno-65-29 href=#__codelineno-65-29></a>    <span class=p>}</span>
<a id=__codelineno-65-30 name=__codelineno-65-30 href=#__codelineno-65-30></a>
<a id=__codelineno-65-31 name=__codelineno-65-31 href=#__codelineno-65-31></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Next, define <code>process</code> function that will be passed as the input parameter to create a <code>ChassisModel</code> object. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>):</span>
<a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a>    <span class=c1># load data</span>
<a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a>    <span class=n>inputs</span> <span class=o>=</span> <span class=n>preprocess_inputs</span><span class=p>(</span><span class=n>input_bytes</span><span class=p>)</span>
<a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a>    <span class=c1># make predictions</span>
<a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a>    <span class=n>output</span> <span class=o>=</span> <span class=n>clf</span><span class=o>.</span><span class=n>predict_proba</span><span class=p>(</span><span class=n>inputs</span><span class=p>)</span>
<a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a>    <span class=c1># process output</span>
<a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a>    <span class=n>structured_output</span> <span class=o>=</span> <span class=n>postprocess_outputs</span><span class=p>(</span><span class=n>output</span><span class=p>)</span>
<a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a>    <span class=k>return</span> <span class=n>structured_output</span>
</code></pre></div> <p>Initialize Chassis Client and create Chassis model. Replace the URL with your Chassis connection. If you followed these <a href=https://chassis.ml/tutorials/devops-deploy/ >installation instructions</a>, keep the local host URL as is, but if you are connected to the publicly-hosted Chassis instance, replace the URL with the URL you receive after <a href=https://modzy.com/chassis-ml-sign-up/ >signing up</a>. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=n>chassis_client</span> <span class=o>=</span> <span class=n>chassisml</span><span class=o>.</span><span class=n>ChassisClient</span><span class=p>(</span><span class=s2>&quot;http://localhost:5000&quot;</span><span class=p>)</span>
<a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=n>chassis_model</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>create_model</span><span class=p>(</span><span class=n>process_fn</span><span class=o>=</span><span class=n>process</span><span class=p>)</span>
</code></pre></div> <p>Test <code>chassis_model</code> locally.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=n>sample_filepath</span> <span class=o>=</span> <span class=s1>&#39;./data/sample_iris.csv&#39;</span>
<a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=n>results</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</code></pre></div> <p>Before kicking off the Chassis job, we can test our <code>ChassisModel</code> in the environment that will be built within the container. <strong>Note</strong>: Chassis will infer the required packages, functions, or variables required to successfully run inference within the <code>process</code> function. This step ensures when the conda environment is created within the Docker container, your model will run.</p> <p><strong>NOTE</strong>: <code>test_env</code> function not available in <a href=../../getting-started/getting-started/ >publicly-hosted</a> service.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=n>test_env_result</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>test_env</span><span class=p>(</span><span class=n>sample_filepath</span><span class=p>)</span>
<a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=nb>print</span><span class=p>(</span><span class=n>test_env_result</span><span class=p>)</span>
</code></pre></div> <p>Lastly, publish your model with your Docker credentials.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=n>dockerhub_user</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>username</span><span class=o>&gt;</span>
<a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=n>dockerhub_pass</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>my</span><span class=o>.</span><span class=n>password</span><span class=o>&gt;</span>
<a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a>
<a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=n>response</span> <span class=o>=</span> <span class=n>chassis_model</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span>
<a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a>    <span class=n>model_name</span><span class=o>=</span><span class=s2>&quot;PMML Random Forest Iris Classification&quot;</span><span class=p>,</span>
<a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a>    <span class=n>model_version</span><span class=o>=</span><span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a>    <span class=n>registry_user</span><span class=o>=</span><span class=n>dockerhub_user</span><span class=p>,</span>
<a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a>    <span class=n>registry_pass</span><span class=o>=</span><span class=n>dockerhub_pass</span><span class=p>,</span>
<a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=p>)</span>
<a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a>
<a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=n>job_id</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;job_id&#39;</span><span class=p>)</span>
<a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=n>final_status</span> <span class=o>=</span> <span class=n>chassis_client</span><span class=o>.</span><span class=n>block_until_complete</span><span class=p>(</span><span class=n>job_id</span><span class=p>)</span>
</code></pre></div> <h2 id=tensorflow-keras>Tensorflow &amp; Keras</h2> <p><em>Coming Soon</em></p> <h2 id=spacy>Spacy</h2> <p><em>Coming Soon</em></p> <h2 id=spark-mllib>Spark MLlib</h2> <p><em>Coming Soon</em></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../tutorials/ds-deploy/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Deploy Model to KServe" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Deploy Model to KServe </div> </div> </a> <a href=../common-data-types/ class="md-footer__link md-footer__link--next" aria-label="Next: Common Data Types Support" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Common Data Types Support </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Modzy </div> </div> <div class=md-social> <a href=https://discord.gg/eW4kHSm3Z5 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://pypi.org/project/chassisml/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> <a href=https://join.slack.com/t/mlops-community/shared_invite/zt-10jopsclv-sny902l2GOFdElU2blfACg target=_blank rel=noopener title=join.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://github.com/modzy/chassis target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.footer", "navigation.expand", "navigation.tabs", "navigation.top", "toc.integrate", "content.tabs.link", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> <script src=../../assets/javascripts/custom.b6ec88ce.min.js></script> <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script> --> <!-- <script>hljs.initHighlightingOnLoad();</script> --> </body> </html>